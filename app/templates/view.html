{% extends 'base.html' %}

{% block head %}
<head>
    <title>{{title}}</title>
</head>
{% endblock %}

{% block content %}

<h2>User: {{ user.nickname }}</h2>

{% for project in projects %}
    <div class="card" style="width: 50rem">
        <div class="card-body">
        <span class="glyphicon glyphicon-calendar"></span>
        <span class="card-title" id="name_{{ project.name }}">{{ project.name }}</span>
        <input id="project_name{{ project.id }}" value="{{ project.name }}" hidden>
            <button type="button" class="glyphicon glyphicon-pencil" id="edit{{ project.id }}"
                    onclick="editProject({{project.id}}, '{{project.name}}')"></button>
            <button type="button" id="save{{ project.id }}"
                    onclick="updateProject({{project.id}}, '{{project.name}}')" hidden>Save</button>
            <button type="button" class="glyphicon glyphicon-trash" onclick="deleteProject({{project.id}})"></button>
        </div>
        <div class="form-control">
            <span class="glyphicon glyphicon-plus"></span>
            <input id="new_task{{ project.id }}">
            <button type="button" onclick="createTask({{ project.id }})">Add Task</button>
            <span id="task_info{{ project.id }}" hidden></span>
        </div>
    </div>

    {% for task in project.tasks %}
        <ul class="list-group list-group-flush" style="width: 50rem">
                    <li class="list-group-item">
                        <input type="checkbox" id="task_done{{ task.id }}" onchange="doneTask({{ task.id }}, {{ project.id }})"
                           {% if task.status == 'complete' %} checked {% else %} '' {% endif %}>
                        <span id="task_name{{ task.id }}" style="color: plum;">{{ task.name }}</span>
                        <span id="task_deadline{{ task.id }}" style="color: plum;"
                              {% if task.deadline %}{% else %} hidden {% endif %}>
                            {{ task.deadline }}
                        </span>
                        <input id="new_task_name{{ task.id }}" value="{{ task.name }}" hidden>
                        <input class="ui-datepicker" id="datepicker{{ task.id }}" placeholder="{{ task.deadline }}"
                                onclick="showDate({{ task.id }})"
                                {% if task.deadline %} value="{{ task.deadline }}" {% else %} hidden {% endif %}>
                        <button type="button" class="glyphicon glyphicon-triangle-top" id="move_task_up{{ task.id }}"
                                onclick="changePriority({{ task.id }}, {{ project.id }}, 'up')"></button>
                        <button type="button" class="glyphicon glyphicon-triangle-bottom" id="move_task_down{{ task.id }}"
                                onclick="changePriority({{ task.id }}, {{ project.id }}, 'down')"></button>
                        <button type="button" class="butt glyphicon glyphicon-pencil" id="edit_task{{ task.id }}"
                                onclick="editTask({{ task.id }})"></button>
                        <button type="button" class="glyphicon glyphicon-saved" id="save_task{{ task.id }}"
                                onclick="updateTask({{ task.id }}, {{ project.id }})" hidden></button>
                        <button type="button" class="glyphicon glyphicon-trash"
                                onclick="deleteTask({{ task.id }}, {{ project.id }})"></button>
                    </li>
                    <span id="new_task_info" hidden></span>
        </ul>
    {% endfor %}
{% endfor %}

<input id="new_project" hidden>
<button type="button" id="add_project" class="btn btn-primary" onclick="addProject()">
    <span class="glyphicon glyphicon-plus"></span><b>Add TODO List</b>
</button>
<button type="button" id="create_project" class="btn btn-primary" onclick="createProject()" hidden>
    <span class="glyphicon glyphicon-plus"></span><b>Add TODO List</b>
</button>
<br><span id="info"></span>

{% endblock %}